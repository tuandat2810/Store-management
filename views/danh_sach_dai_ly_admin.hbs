<style>
  .agency-list-container {
    min-height: 100vh;
    padding: 0;
  }

  .agency-list-title {
    text-align: left;
    font-size: 2rem;
    font-weight: 600;
    margin-top: 32px;
    margin-bottom: 0;
  }

  .agency-list-content {
    width: 95%;
    margin: 0 auto;
  }


  .agency-table-container {
    margin: 16px;
  }

  .pagination .page-link {
    color: black;                /* Màu chữ */
    background-color: #fff;      /* Màu nền (trang hiện tại có thể giữ nguyên) */
    border-color: black;         /* Màu viền */
  }

  .pagination .page-item.active .page-link {
    background-color: black;     /* Nền khi active */
    border-color: black;         /* Viền khi active */
    color: white;                /* Chữ khi active */
  }

  .pagination .page-link:hover {
    background-color: #333;      /* Nền khi hover */
    color: white;
  }
</style>

<div class="agency-list-container w-100">
  <!-- Tiêu đề trang -->
  <h1 class="agency-list-title text-center">
    Danh sách đại lý
  </h1>

  <!-- Container bọc search bar và table -->
  <div class="agency-list-content">
    <!-- Thanh tìm kiếm (search bar) căn phải -->
    <div class="d-flex justify-content-end mb-3">
      <div class="input-group" style="width: 300px;">
        <input
          type="text"
          class="form-control"
          placeholder="Tìm kiếm đại lý..."
          id="searchInput"
          value="{{searchQuery}}"
        />
        <button class="btn btn-outline-secondary" type="button" onclick="clearSearch()">
          <i class="bi bi-x"></i>
        </button>
        <button class="btn btn-outline-dark" type="button" onclick="performSearch()">
          <i class="bi bi-search"></i>
        </button>
        <ul id="suggestions" class="list-group position-absolute w-100" style="top: 100%; z-index: 1000;"></ul>
      </div>
    </div>


    <!-- Bảng dữ liệu sử dụng Bootstrap -->
  <div class="agency-table-container">
    <table class="table table-striped">
      <thead>
        <tr>
          <th scope="col" class="text-center" style="width: 5%;">#</th>
          <th scope="col" class="text-center" style="width: 16%;">Tên đại lý</th>
          <th scope="col" class="text-center" style="width: 12%;">Người quản lý</th>
          <th scope="col" class="text-center" style="width: 6%;">Loại</th>
          <th scope="col" class="text-center" style="width: 6%;">Quận</th>
          <th scope="col" class="text-center" style="width: 39%;">Địa chỉ</th>
          <th scope="col" class="text-center" style="width: 15%;">Trạng thái</th>
        </tr>
      </thead>
      <tbody>
        {{#each agencyList}}
          <tr>
            <td class="text-center">{{ agencyCode }}</td>
            <td class="text-center">{{ name }}</td>
            <td class="text-center">{{ managerUsername }}</td>
            <td class="text-center">{{ type }}</td>
            <td class="text-center">{{ district }}</td>
            <td class="text-center">{{ address }}</td>
            <td class="text-center">
              {{#eq status "Đã duyệt"}}
                <span class="badge bg-success">Đã được duyệt</span>
              {{/eq}}
              {{#eq status "Đang chờ"}}
                <span class="badge bg-secondary">Đang chờ duyệt</span>
              {{/eq}}
              {{#eq status "Từ chối"}}
                <span class="badge bg-danger">Đã bị từ chối</span>
              {{/eq}}
            </td>
          </tr>
        {{/each}}
      </tbody>
    </table>
  </div>




    <!-- Pagination căn giữa -->
    <div class="d-flex justify-content-center agency-pagination-row">
      <nav aria-label="Page navigation">
        <ul class="pagination">

          {{!-- Nút Previous --}}
          <li class="page-item {{#if (eq1 currentPage 1)}}disabled{{/if}}">
            <a class="page-link" href="?page={{subtract currentPage 1}}">Previous</a>
          </li>

          {{!-- Danh sách số trang --}}
          {{#each pages}}
            <li class="page-item {{#if (eq1 this ../currentPage)}}active{{/if}}">
              <a class="page-link" href="?page={{this}}">{{this}}</a>
            </li>
          {{/each}}

          {{!-- Nút Next --}}
          <li class="page-item {{#if (eq1 currentPage cntPage)}}disabled{{/if}}">
            <a class="page-link" href="?page={{add currentPage 1}}">Next</a>
          </li>

        </ul>
      </nav>
    </div>
  </div>
</div>

<script>
  // Khi người dùng nhấn nút tìm kiếm
  function performSearch() {
    const searchQuery = document.getElementById('searchInput').value.trim();
    if (searchQuery) {
      // Thực hiện tìm kiếm với từ khóa
      window.location.href = `/main/danh_sach_dai_ly_admin?search=${encodeURIComponent(searchQuery)}&page=1`;
    }
  }

  // Khi người dùng nhấn nút xóa
  function clearSearch() {
    document.getElementById('searchInput').value = ''; // Xóa từ khóa tìm kiếm
    window.location.href = '/main/danh_sach_dai_ly_admin?page=1'; // Reset lại trang và tìm kiếm
  }

  // Khi người dùng nhấn phím Enter trong ô tìm kiếm
  document.getElementById('searchInput').addEventListener('keypress', function(event) {
    if (event.key === 'Enter') {
      event.preventDefault();
      performSearch();
    }
  });

  // Khi người dùng gõ tìm kiếm sẽ đề xuất nội dung liên quan
  searchInput.addEventListener("input", () => {
  const query = searchInput.value.trim();

  if (!query) {
    suggestions.innerHTML = "";
    return; // return này nằm đúng trong hàm arrow function
  }

  fetch(`/main/dai-ly-suggestions?query=${encodeURIComponent(query)}`)
    .then(res => res.json())
    .then(data => {
      suggestions.innerHTML = "";
      data.forEach(name => {
        const li = document.createElement("li");
        li.textContent = name;
        li.className = "list-group-item list-group-item-action";
        li.onclick = () => {
          searchInput.value = name;
          suggestions.innerHTML = "";
          performSearch();
        };
        suggestions.appendChild(li);
      });
    });
  });
  // Khi click ra ngoài thì xóa gợi ý
  document.addEventListener("click", (e) => {
    const isClickInsideInput = searchInput.contains(e.target);
    const isClickInsideSuggestions = suggestions.contains(e.target);
    if (!isClickInsideInput && !isClickInsideSuggestions) {
      suggestions.innerHTML = "";
    }

    if (isClickInsideInput && searchInput.value.trim() !== "") {
      fetch(`/main/dai-ly-suggestions?query=${encodeURIComponent(searchInput.value.trim())}`)
        .then(res => res.json())
        .then(data => {
          suggestions.innerHTML = "";
          data.forEach(name => {
            const li = document.createElement("li");
            li.textContent = name;
            li.className = "list-group-item list-group-item-action";
            li.onclick = () => {
              searchInput.value = name;
              suggestions.innerHTML = "";
              performSearch();
            };
            suggestions.appendChild(li);
          });
      });
    }
  })

</script>
