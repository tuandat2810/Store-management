<!-- views/partials/sidebar.hbs -->
<style>
    .sidebar-item.nav-link.active {
        background-color: #808080 !important;
        color: white !important;
    }

</style>

{{#eq user.type "user"}}
<div class="d-flex flex-column flex-shrink-0 p-3 bg-body-tertiary" style="width: 280px; height: 100vh;">
    <a href="/" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto link-body-emphasis text-decoration-none">
        <i class="bi bi-person-circle pe-none me-2 fs-4"></i>
        <span class="fs-4">Đại lý</span>
    </a>
    <hr>
    <ul class="nav nav-pills flex-column mb-auto">
        <li class="nav-item">
            <a href="#" class="sidebar-item nav-link link-body-emphasis active" aria-current="page" data-section="home">
                <i class="bi bi-house-door me-2"></i>
                Trang chủ
            </a>
        </li>
        <li class="nav-item">
            <a href="#" class="sidebar-item nav-link link-body-emphasis" data-section="thong_tin_dai_ly">
                <i class="bi bi-people me-2"></i>
                Thông tin đại lý
            </a>
        </li>
        <li class="nav-item">
            <a href="#" class="sidebar-item nav-link link-body-emphasis" data-section="dang_ki_dai_ly">
                <i class="bi bi-pen me-2"></i>
                Đăng ký đại lý
            </a>
        </li>
        <li class="nav-item">
            <a href="#" class="sidebar-item nav-link link-body-emphasis" data-section="danh_sach_dai_ly">
                <i class="bi bi-grid me-2"></i>
                Danh sách đại lý
            </a>
        </li>
        <li class="nav-item">
            <a href="#" class="sidebar-item nav-link link-body-emphasis" data-section="lap_phieu_xuat_hang">
                <i class="bi bi-clipboard2-fill me-2"></i>
                Lập phiếu xuất hàng
            </a>
        </li>
        <li class="nav-item">
            <a href="#" class="sidebar-item nav-link link-body-emphasis" data-section="bao_cao_hang_thang">
                <i class="bi bi-graph-up me-2"></i>
                Báo cáo hàng tháng
            </a>
        </li>
    </ul>
    <hr>
</div>
{{else}}
<style>
    .sidebar-item.nav-link.active {
        background-color: #808080 !important;
        color: white !important;
    }

</style>

<div class="d-flex flex-column flex-shrink-0 p-3 bg-body-tertiary" style="width: 280px; height: 100vh;">
<a href="/" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto link-body-emphasis text-decoration-none">
    <i class="bi bi-person-circle pe-none me-2 fs-4"></i>
    <span class="fs-4">Admin</span>
</a>
<hr>
<ul class="nav nav-pills flex-column mb-auto">
    <li class="nav-item">
        <a href="#" class="sidebar-item nav-link link-body-emphasis" aria-current="page" data-section="home">
            <i class="bi bi-house-door me-2"></i>
            Trang chủ
        </a>
    </li>
    
    <li>
        <a href="#" class="sidebar-item nav-link link-body-emphasis" data-section="thong_tin_admin">
            <i class="bi bi-people me-2"></i>
            Thông tin admin
        </a>
    </li>
    
    <li>
        <a href="#" class="sidebar-item nav-link link-body-emphasis" data-section="quan_ly_dai_ly_admin">
            <i class="bi bi-table me-2"></i>
            Quản lý đại lý
        </a>
    </li>
    <li>
        <a href="#" class="sidebar-item nav-link link-body-emphasis" data-section="quan_ly_loai_dai_ly">
            <i class="bi bi-table me-2"></i>
            Quản lý loại đại lý
        </a>
    </li>
    <li>
        <a href="#" class="sidebar-item nav-link link-body-emphasis" data-section="danh_sach_dai_ly_admin">
            <i class="bi bi-grid me-2"></i>
            Danh sách đại lý
        </a>
    </li>
    <li>
        <a href="#" class="sidebar-item nav-link link-body-emphasis" data-section="lap_phieu_thu_tien">
            <i class="bi bi-clipboard2-fill me-2"></i>
            Lập phiếu thu tiền
        </a>
    </li>
    <li>
        <a href="#" class="sidebar-item nav-link link-body-emphasis" data-section="bao_cao_hang_thang_admin">
            <i class="bi bi-graph-up me-2"></i>
            Báo cáo hàng tháng
        </a>
    </li>
    <li>
        <a href="#" class="sidebar-item nav-link link-body-emphasis" data-section="duyet_phieu_xuat_hang">
            <i class="bi bi-building-fill-check me-2"></i>
            Duyệt phiếu xuất hàng
        </a>
    </li>
    <li>
        <a href="#" class="sidebar-item nav-link link-body-emphasis" data-section="thay_doi_quy_dinh">
            <i class="bi bi-pen me-2"></i>
            Thay đổi quy định
        </a>
    </li>
</ul>
</div>
{{/eq}}


<script>
    document.addEventListener('DOMContentLoaded', () => {
        const sidebarItems = document.querySelectorAll('.sidebar-item');

        // 1. Xác định section khởi tạo (khi reload / truy cập trực tiếp)
        //    VD: URL = /page/section/thong_tin_dai_ly → section = "thong_tin_dai_ly"
        const match = window.location.pathname.match(/\/page\/section\/([^\/]+)/);
        const initialSection = match ? match[1] : null;

        // Ghi state ban đầu để popstate hoạt động ngay
        history.replaceState({ section: initialSection }, '', window.location.pathname);

        // Hàm load partial
        function loadSection(section) {
            axios.get(`/page/ajax/section/${section}`)
            .then(res => {
                document.getElementById('main-content').innerHTML = res.data;
            })
            .catch(err => console.error('Lỗi tải nội dung:', err));
        }

        // Hàm cập nhật active sidebar
        function updateActive(section) {
            sidebarItems.forEach(item => {
            item.classList.remove('active');
            item.removeAttribute('aria-current');
            if (item.dataset.section === section) {
                item.classList.add('active');
                item.setAttribute('aria-current', 'page');
            }
            });
        }

        // 2. Bắt sự kiện click
        sidebarItems.forEach(item => {
            item.addEventListener('click', e => {
            e.preventDefault();
            const section = item.dataset.section;
            // Nếu là "home", chuyển hướng trang (full load)
            if (section === 'home') {
                window.location.href = '/page/home';
                return;
            }
            // Các Sectio khác
            updateActive(section);
            loadSection(section);

            // 3. Đẩy URL direct lên history
            history.pushState({ section }, '', `/page/section/${section}`);
            });
        });

        // 4. Xử lý Back / Forward
        window.addEventListener('popstate', e => {
            const section = (e.state && e.state.section) || initialSection;
            if (!section) return;
            updateActive(section);
            loadSection(section);
        });

        // 5. Nếu là lần đầu load và có section trong URL, load nó luôn
        if (initialSection) {
            updateActive(initialSection);
            loadSection(initialSection);
        }
    });
</script>