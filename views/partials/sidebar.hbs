<!-- views/partials/sidebar.hbs -->
<style>
    .sidebar-item.nav-link.active {
        background-color: #808080 !important;
        color: white !important;
    }

    .sidebar-item.nav-link:hover {
        background-color: #ccc !important;
        color: white !important;
    }
</style>

{{#eq user.type "user"}}
<div class="d-flex flex-column flex-shrink-0 p-3 bg-body-tertiary"
    style="position: fixed; top: 70px; left: 0; width: 280px; height: 100vh; overflow-y: auto;">
    <a href="/user/home"
        class="d-flex align-items-center me-md-auto link-body-emphasis text-decoration-none sidebar-item"
        style="gap: 8px; padding-left: 15px; margin-bottom: 4px;" data-section="thong_tin_dai_ly">
        <i class="bi bi-person-circle" style="width: 32px; height: 36px; line-height: 36px; font-size: 24px;"></i>
        <div class="d-flex flex-column justify-content-center" style="line-height: 1; margin: 0;">
            <span class="fs-7 fw-semibold mb-0" style="margin: 0; line-height: 1;">{{user.fullname}}</span>
            <small class="text-muted" style="font-size: 12px; margin: 0; line-height: 1;">{{user.type}}</small>
        </div>
    </a>
    <hr>
    <ul class="nav nav-pills flex-column mb-auto">
        <li class="nav-item">
            <a href="/user/home" class="sidebar-item nav-link link-body-emphasis" data-section="home">
                <i class="bi bi-house-door me-2"></i>
                Trang chủ
            </a>
        </li>
        <li class="nav-item">
            <a href="/user/info" class="sidebar-item nav-link link-body-emphasis" data-section="thong_tin_tai_khoan">
                <i class="bi bi-people me-2"></i>
                Thông tin tài khoản
            </a>
        </li>
        <li class="nav-item">
            <a href="/agency/register" class="sidebar-item nav-link link-body-emphasis" data-section="dang_ki_dai_ly">
                <i class="bi bi-pen me-2"></i>
                Đăng ký đại lý
            </a>
        </li>
        <li class="nav-item">
            <a href="/agency/view" class="sidebar-item nav-link link-body-emphasis" data-section="danh_sach_dai_ly">
                <i class="bi bi-grid me-2"></i>
                Danh sách đại lý
            </a>
        </li>
        <li class="nav-item">
            <a href="/order/create" class="sidebar-item nav-link link-body-emphasis" data-section="lap_phieu_xuat_hang">
                <i class="bi bi-clipboard2-fill me-2"></i>
                Lập phiếu xuất hàng
            </a>
        </li>
        <li class="nav-item">
            <a href="/order/view" class="sidebar-item nav-link link-body-emphasis" data-section="xem_phieu_xuat_hang">
                <i class="bi bi-file-earmark-check me-2"></i>
                Xem phiếu xuất hàng
            </a>
        </li>
        <li class="nav-item">
            <a href="/receipt/view" class="sidebar-item nav-link link-body-emphasis" data-section="xem_phieu_thu_tien">
                <i class="bi bi-receipt me-2"></i>
                Xem phiếu thu tiền
            </a>
        </li>
        <li class="nav-item">
            <a href="/main/report" class="sidebar-item nav-link link-body-emphasis" data-section="bao_cao_hang_thang">
                <i class="bi bi-graph-up me-2"></i>
                Báo cáo hàng tháng
            </a>
        </li>
    </ul>
    <hr>
</div>
{{else}}
<style>
    .sidebar-item.nav-link.active {
        background-color: #808080 !important;
        color: white !important;
    }
</style>

<div class="d-flex flex-column flex-shrink-0 p-3 bg-body-tertiary"
    style="position: fixed; top: 70px; left: 0; width: 280px; height: 100vh; overflow-y: auto;">
    <a href="/user/home"
        class="d-flex align-items-center me-md-auto link-body-emphasis text-decoration-none sidebar-item"
        style="gap: 8px; padding-left: 15px; margin-bottom: 4px;" data-section="thong_tin_admin">
        <i class="bi bi-person-circle" style="width: 32px; height: 36px; line-height: 36px; font-size: 24px;"></i>
        <div class="d-flex flex-column justify-content-center" style="line-height: 1; margin: 0;">
            <span class="fs-7 fw-semibold mb-0" style="margin: 0; line-height: 1;">{{user.fullname}}</span>
            <small class="text-muted" style="font-size: 12px; margin: 0; line-height: 1;">{{user.type}}</small>
        </div>
    </a>
    <hr>
    <ul class="nav nav-pills flex-column mb-auto">
        <li class="nav-item">
            <a href="/user/home" class="sidebar-item nav-link link-body-emphasis" data-section="home">
                <i class="bi bi-house-door me-2"></i>
                Trang chủ
            </a>
        </li>

        <li>
            <a href="/user/info" class="sidebar-item nav-link link-body-emphasis" data-section="thong_tin_tai_khoan">
                <i class="bi bi-people me-2"></i>
                Thông tin tài khoản
            </a>
        </li>

        <li>
            <a href="/agency/manage" class="sidebar-item nav-link link-body-emphasis" data-section="quan_ly_dai_ly">
                <i class="bi bi-table me-2"></i>
                Quản lý đại lý
            </a>
        </li>
        <li>
            <a href="/agency/view" class="sidebar-item nav-link link-body-emphasis" data-section="danh_sach_dai_ly">
                <i class="bi bi-grid me-2"></i>
                Danh sách đại lý
            </a>
        </li>
        <li>
            <a href="/receipt/create" class="sidebar-item nav-link link-body-emphasis"
                data-section="lap_phieu_thu_tien">
                <i class="bi bi-clipboard2-fill me-2"></i>
                Lập phiếu thu tiền
            </a>
        </li>
        <li class="nav-item">
            <a href="/main/report" class="sidebar-item nav-link link-body-emphasis" data-section="bao_cao_hang_thang">
                <i class="bi bi-graph-up me-2"></i>
                Báo cáo hàng tháng
            </a>
        </li>
        <li class="nav-item">
            <a href="/order/view" class="sidebar-item nav-link link-body-emphasis" data-section="xem_phieu_xuat_hang">
                <i class="bi bi-file-earmark-check me-2"></i>
                Xem phiếu xuất hàng
            </a>
        </li>
        <li class="nav-item">
            <a href="/receipt/view" class="sidebar-item nav-link link-body-emphasis" data-section="xem_phieu_thu_tien">
                <i class="bi bi-receipt me-2"></i>
                Xem phiếu thu tiền
            </a>
        </li>
        <li>
            <a href="/policy/view" class="sidebar-item nav-link link-body-emphasis" data-section="thay_doi_quy_dinh">
                <i class="bi bi-pen me-2"></i>
                Thay đổi quy định
            </a>
        </li>
    </ul>
</div>
{{/eq}}


<script>
    document.addEventListener('DOMContentLoaded', () => {
        const sidebarItems = document.querySelectorAll('.sidebar-item');
        const path = window.location.pathname;

        const sectionMap = {
            '/user/home': 'home',
            '/user/info': 'thong_tin_tai_khoan',
            '/agency/register': 'dang_ki_dai_ly',
            '/agency/view': 'danh_sach_dai_ly',
            '/order/create': 'lap_phieu_xuat_hang',
            '/order/view': 'xem_phieu_xuat_hang',
            '/receipt/view': 'xem_phieu_thu_tien',
            '/receipt/create': 'lap_phieu_thu_tien',
            '/main/report': 'bao_cao_hang_thang',
            '/agency/manage': 'quan_ly_dai_ly',
            '/policy/view': 'thay_doi_quy_dinh'
        };

        const section = sectionMap[path] || 'home'; // fallback nếu không khớp

        function updateActive(sec) {
            sidebarItems.forEach(item => {
                item.classList.remove('active');
                if (item.dataset.section === sec) {
                    item.classList.add('active');
                    item.setAttribute('aria-current', 'page');
                }
            });
        }

        // Highlight ban đầu
        updateActive(section);

        // Nếu có dùng AJAX hoặc muốn hiệu ứng khi click
        sidebarItems.forEach(item => {
            item.addEventListener('click', () => {
                const sec = item.dataset.section;
                updateActive(sec);
            });
        });
    });
</script>
